{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _classCallCheck from \"@babel/runtime/helpers/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/createClass\";\nimport _inherits from \"@babel/runtime/helpers/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/getPrototypeOf\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"C:\\\\Users\\\\s4397674\\\\Documents\\\\PP\\\\test\\\\components\\\\ShopScreen.js\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport Icon from \"@expo/vector-icons/Ionicons\";\nimport React, { Component, useState, useEffect } from \"react\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport ImageBackground from \"react-native-web/dist/exports/ImageBackground\";\nimport SafeAreaView from \"react-native-web/dist/exports/SafeAreaView\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport { createAppContainer } from \"react-navigation\";\nimport { createMaterialTopTabNavigator } from \"react-navigation-tabs\";\nimport { fb, Fire } from \"../src/firebase/APIKeys\";\nimport { images, getBackgroundImage } from \"../components/images\";\nimport Header from \"../components/Header\";\nvar baseCurrency = 100;\nvar userid = Fire.shared.user._id;\n\nfunction OwnedTab() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      read = _useState2[0],\n      allReads = _useState2[1];\n\n  useEffect(function () {\n    var readRef = fb.database().ref(\"response/\" + userid + \"/shop\");\n    var OnLoadingListener = readRef.on(\"value\", function (snapshot) {\n      allReads([]);\n      snapshot.forEach(function (childSnapshot) {\n        allReads(function (read) {\n          return [].concat(_toConsumableArray(read), [childSnapshot.val()]);\n        });\n      });\n    });\n    return function () {\n      readRef.off(\"value\", OnLoadingListener);\n    };\n  }, []);\n  return React.createElement(View, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 5\n    }\n  }, React.createElement(SafeAreaView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }\n  }, React.createElement(ScrollView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 45,\n      columnNumber: 9\n    }\n  }, read.map(function (item, index) {\n    if (item[\"bought\"]) {\n      if (item[\"img\"] === 0) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 50,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character0,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 51,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 52,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"Set\",\n          disabled: false,\n          onPress: function onPress() {\n            return setAvatar(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 53,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 1) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 62,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character1,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 63,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 64,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"Set\",\n          disabled: false,\n          onPress: function onPress() {\n            return setAvatar(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 65,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 2) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 74,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 75,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 76,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"Set\",\n          disabled: false,\n          onPress: function onPress() {\n            return setAvatar(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 77,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 3) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 86,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 87,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"Set\",\n          disabled: false,\n          onPress: function onPress() {\n            return setAvatar(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 89,\n            columnNumber: 21\n          }\n        }));\n      }\n    }\n  }))));\n}\n\nOwnedTab.navigationOptions = {\n  tabBarIcon: function tabBarIcon(_ref) {\n    var tintColor = _ref.tintColor,\n        focused = _ref.focused;\n    return React.createElement(Icon, {\n      name: focused ? \"ios-basket\" : \"md-basket\",\n      color: tintColor,\n      size: 25,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 5\n      }\n    });\n  }\n};\n\nvar recordBuying = function recordBuying(index, buy, imgUrl, itemPrice) {\n  return new Promise(function (resolve, reject) {\n    var data = {\n      bought: buy,\n      img: imgUrl,\n      price: itemPrice\n    };\n    fb.database().ref(\"response/\" + userid + \"/shop/\" + index).update(data).then(function (snapshot) {\n      resolve(snapshot);\n    }).catch(function (err) {\n      reject(err);\n    });\n  });\n};\n\nfunction completeBuying(price) {\n  baseCurrency = baseCurrency - price;\n  fb.database().ref(\"response/\" + userid + \"/\").update({\n    currency: baseCurrency\n  }).then(function () {\n    console.log(\"Success buying\");\n  }).catch(function (error) {\n    console.log(error);\n  });\n}\n\nfunction confirmBuying(item, index) {\n  Alert.alert(\"Are you sure?\", \"Unlock this avatar with $\" + item[\"price\"], [{\n    text: \"Cancel\",\n    onPress: function onPress() {\n      return console.log(\"Cancel Pressed\");\n    },\n    style: \"cancel\"\n  }, {\n    text: \"OK\",\n    onPress: function onPress() {\n      if (baseCurrency >= item[\"price\"]) {\n        completeBuying(item[\"price\"]);\n        recordBuying(index, !item[\"bought\"], item[\"img\"], item[\"price\"]);\n      } else {\n        Alert.alert(\"Sorry, you can't afford this item.\");\n      }\n    }\n  }], {\n    cancelable: false\n  });\n}\n\nfunction setAvatar(item, index) {\n  Alert.alert(\"Are you sure?\", \"Raise this avatar on home page\", [{\n    text: \"Cancel\",\n    onPress: function onPress() {\n      return console.log(\"Cancel Pressed\");\n    },\n    style: \"cancel\"\n  }, {\n    text: \"OK\",\n    onPress: function onPress() {\n      console.log(\"hello olivia, you reached here\");\n      updataAvatar(index);\n    }\n  }], {\n    cancelable: false\n  });\n}\n\nfunction updataAvatar(data) {\n  console.log(\"print out the avatar index: \" + data);\n  fb.database().ref(\"response/\" + userid + \"/\").update({\n    character: data\n  }).then(function () {\n    console.log(\"Success buying\");\n  }).catch(function (error) {\n    console.log(error);\n  });\n}\n\nfunction ShopTab() {\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      unbought = _useState4[0],\n      allUnbought = _useState4[1];\n\n  useEffect(function () {\n    var unboughtRef = fb.database().ref(\"/response/\" + userid + \"/shop\");\n    var OnLoadingListener = unboughtRef.on(\"value\", function (snapshot) {\n      allUnbought([]);\n      snapshot.forEach(function (childSnapshot) {\n        allUnbought(function (unbought) {\n          return [].concat(_toConsumableArray(unbought), [childSnapshot.val()]);\n        });\n      });\n    });\n    return function () {\n      unboughtRef.off(\"value\", OnLoadingListener);\n    };\n  }, []);\n  return React.createElement(View, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 5\n    }\n  }, React.createElement(SafeAreaView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 7\n    }\n  }, React.createElement(ScrollView, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }\n  }, unbought.map(function (item, index) {\n    if (!item[\"bought\"]) {\n      if (item[\"img\"] === 0) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 243,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character0,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 244,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 245,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"buy\",\n          disabled: false,\n          onPress: function onPress() {\n            return confirmBuying(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 246,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 1) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 255,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character1,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 256,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 257,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"buy\",\n          disabled: false,\n          onPress: function onPress() {\n            return confirmBuying(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 258,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 2) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character2,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 268,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 269,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"buy\",\n          disabled: false,\n          onPress: function onPress() {\n            return confirmBuying(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 270,\n            columnNumber: 21\n          }\n        }));\n      } else if (item[\"img\"] === 3) {\n        return React.createElement(View, {\n          key: item[\"img\"],\n          style: styles.itemContainer,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 279,\n            columnNumber: 19\n          }\n        }, React.createElement(Image, {\n          style: styles.avatar,\n          source: images.character3,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 280,\n            columnNumber: 21\n          }\n        }), React.createElement(Text, {\n          style: styles.text,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 281,\n            columnNumber: 21\n          }\n        }, \"Price: \", item[\"price\"]), React.createElement(Button, {\n          title: \"buy\",\n          disabled: false,\n          onPress: function onPress() {\n            return confirmBuying(item, index);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 21\n          }\n        }));\n      }\n    }\n  }))));\n}\n\nShopTab.navigationOptions = {\n  tabBarIcon: function tabBarIcon(_ref2) {\n    var tintColor = _ref2.tintColor,\n        focused = _ref2.focused;\n    return React.createElement(Icon, {\n      name: focused ? \"ios-cart\" : \"md-cart\",\n      color: tintColor,\n      size: 25,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 5\n      }\n    });\n  }\n};\nvar Tab = createMaterialTopTabNavigator({\n  Shop: ShopTab,\n  Owned: OwnedTab\n}, {\n  tabBarOptions: {\n    activeTintColor: \"black\",\n    showIcon: true,\n    showLabel: true,\n    style: {\n      backgroundColor: \"transparent\"\n    }\n  }\n});\nvar AppIndex = createAppContainer(Tab);\n\nvar HomeScreen = function (_Component) {\n  _inherits(HomeScreen, _Component);\n\n  var _super = _createSuper(HomeScreen);\n\n  function HomeScreen(props) {\n    var _this;\n\n    _classCallCheck(this, HomeScreen);\n\n    _this = _super.call(this, props);\n    _this.state = {\n      avatarCurrency: 0,\n      items: {}\n    };\n\n    if (!fb.apps.length) {\n      fb.initializeApp(ApiKeys.FirebaseConfig);\n    }\n\n    _this.readData();\n\n    return _this;\n  }\n\n  _createClass(HomeScreen, [{\n    key: \"readData\",\n    value: function readData() {\n      var _this2 = this;\n\n      userid = Fire.shared.user._id;\n      fb.database().ref(\"response/\" + userid + \"/currency\").once(\"value\", function (dataSnapShot) {\n        baseCurrency = dataSnapShot.val();\n      });\n      fb.database().ref(\"response/\" + userid + \"/backgroundColor\").once(\"value\", function (dataSnapShot) {\n        var tempColor = dataSnapShot.val();\n\n        _this2.setState({\n          backgroundColor: tempColor\n        });\n      });\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      var _this3 = this;\n\n      fb.database().ref(\"response/\" + userid + \"/shop\").on(\"value\", function (querySnapShot) {\n        var data = querySnapShot.val() ? querySnapShot.val() : {};\n\n        var shopitems = _objectSpread({}, data);\n\n        _this3.setState({\n          items: shopitems\n        });\n      });\n      fb.database().ref(\"response/\" + userid + \"/currency\").on(\"value\", function (querySnapShot) {\n        var data = querySnapShot.val() ? querySnapShot.val() : {};\n\n        _this3.setState({\n          avatarCurrency: data\n        });\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var background = getBackgroundImage(this.state.backgroundColor);\n      return React.createElement(View, {\n        style: styles.container,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 372,\n          columnNumber: 7\n        }\n      }, React.createElement(ImageBackground, {\n        source: background,\n        style: styles.backgroundImage,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 9\n        }\n      }, React.createElement(Header, {\n        props: this.props,\n        pageName: \"Avatar Shop\",\n        baseCurrency: this.state.avatarCurrency,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 374,\n          columnNumber: 11\n        }\n      }), React.createElement(AppIndex, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 11\n        }\n      })));\n    }\n  }]);\n\n  return HomeScreen;\n}(Component);\n\nexport { HomeScreen as default };\nvar styles = StyleSheet.create({\n  container: {\n    backgroundColor: \"#f0f8ff\",\n    flex: 1,\n    flexDirection: \"column\"\n  },\n  backgroundImage: {\n    flex: 1,\n    resizeMode: \"cover\",\n    justifyContent: \"center\"\n  },\n  itemContainer: {\n    height: 230,\n    borderWidth: 0.5,\n    alignItems: \"center\",\n    justifyContent: \"center\",\n    margin: 3\n  },\n  avatarContainer: {\n    alignItems: \"center\",\n    justifyContent: \"center\"\n  },\n  avatar: {\n    width: \"30%\",\n    height: \"50%\",\n    alignItems: \"center\"\n  },\n  buyText: {\n    textAlign: \"center\"\n  },\n  text: {\n    marginTop: 5,\n    fontSize: 16,\n    fontWeight: \"500\"\n  }\n});","map":{"version":3,"sources":["C:/Users/s4397674/Documents/PP/test/components/ShopScreen.js"],"names":["Icon","React","Component","useState","useEffect","createAppContainer","createMaterialTopTabNavigator","fb","Fire","images","getBackgroundImage","Header","baseCurrency","userid","shared","user","_id","OwnedTab","read","allReads","readRef","database","ref","OnLoadingListener","on","snapshot","forEach","childSnapshot","val","off","map","item","index","styles","itemContainer","avatar","character0","text","setAvatar","character1","character2","character3","navigationOptions","tabBarIcon","tintColor","focused","recordBuying","buy","imgUrl","itemPrice","Promise","resolve","reject","data","bought","img","price","update","then","catch","err","completeBuying","currency","console","log","error","confirmBuying","Alert","alert","onPress","style","cancelable","updataAvatar","character","ShopTab","unbought","allUnbought","unboughtRef","Tab","Shop","Owned","tabBarOptions","activeTintColor","showIcon","showLabel","backgroundColor","AppIndex","HomeScreen","props","state","avatarCurrency","items","apps","length","initializeApp","ApiKeys","FirebaseConfig","readData","once","dataSnapShot","tempColor","setState","querySnapShot","shopitems","background","container","backgroundImage","StyleSheet","create","flex","flexDirection","resizeMode","justifyContent","height","borderWidth","alignItems","margin","avatarContainer","width","buyText","textAlign","marginTop","fontSize","fontWeight"],"mappings":"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","sourcesContent":["// Homescreen.js\r\n\r\nimport Icon from \"react-native-vector-icons/Ionicons\";\r\nimport React, { Component, useState, useEffect } from \"react\";\r\nimport {\r\n  StyleSheet,\r\n  Text,\r\n  View,\r\n  TouchableOpacity,\r\n  ImageBackground,\r\n  SafeAreaView,\r\n  ScrollView,\r\n  Alert,\r\n  Image,\r\n  Button,\r\n} from \"react-native\";\r\nimport { createAppContainer } from \"react-navigation\";\r\nimport { createMaterialTopTabNavigator } from \"react-navigation-tabs\";\r\nimport { fb, Fire } from \"../src/firebase/APIKeys\";\r\nimport { images, getBackgroundImage } from \"../components/images\";\r\nimport Header from \"../components/Header\";\r\n\r\nvar baseCurrency = 100;\r\nvar userid = Fire.shared.user._id;\r\n\r\n//Owned items tab\r\nfunction OwnedTab() {\r\n  const [read, allReads] = useState([]);\r\n  useEffect(() => {\r\n    const readRef = fb.database().ref(\"response/\" + userid + \"/shop\");\r\n    const OnLoadingListener = readRef.on(\"value\", (snapshot) => {\r\n      allReads([]);\r\n      snapshot.forEach(function (childSnapshot) {\r\n        allReads((read) => [...read, childSnapshot.val()]);\r\n      });\r\n    });\r\n\r\n    return () => {\r\n      readRef.off(\"value\", OnLoadingListener);\r\n    };\r\n  }, []);\r\n  return (\r\n    <View>\r\n      <SafeAreaView>\r\n        <ScrollView>\r\n          {read.map(function (item, index) {\r\n            if (item[\"bought\"]) {\r\n              if (item[\"img\"] === 0) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character0} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"Set\"\r\n                      disabled={false}\r\n                      onPress={() => setAvatar(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 1) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character1} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"Set\"\r\n                      disabled={false}\r\n                      onPress={() => setAvatar(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 2) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character2} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"Set\"\r\n                      disabled={false}\r\n                      onPress={() => setAvatar(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 3) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character3} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"Set\"\r\n                      disabled={false}\r\n                      onPress={() => setAvatar(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              }\r\n            }\r\n          })}\r\n        </ScrollView>\r\n      </SafeAreaView>\r\n    </View>\r\n  );\r\n}\r\nOwnedTab.navigationOptions = {\r\n  tabBarIcon: ({ tintColor, focused }) => (\r\n    <Icon\r\n      name={focused ? \"ios-basket\" : \"md-basket\"}\r\n      color={tintColor}\r\n      size={25}\r\n    />\r\n  ),\r\n};\r\n\r\n//Change the status of bought in firebase\r\nconst recordBuying = (index, buy, imgUrl, itemPrice) => {\r\n  return new Promise(function (resolve, reject) {\r\n    let data = {\r\n      bought: buy,\r\n      img: imgUrl,\r\n      price: itemPrice,\r\n    };\r\n    fb.database()\r\n      .ref(\"response/\" + userid + \"/shop/\" + index)\r\n      .update(data)\r\n      .then((snapshot) => {\r\n        resolve(snapshot);\r\n      })\r\n      .catch((err) => {\r\n        reject(err);\r\n      });\r\n  });\r\n};\r\n\r\n//reduce currency in firebase\r\nfunction completeBuying(price) {\r\n  baseCurrency = baseCurrency - price;\r\n  fb.database()\r\n    .ref(\"response/\" + userid + \"/\")\r\n    .update({\r\n      currency: baseCurrency,\r\n    })\r\n    .then(() => {\r\n      console.log(\"Success buying\");\r\n    })\r\n    .catch((error) => {\r\n      console.log(error);\r\n    });\r\n}\r\n\r\n// Pop up window to check with buying or not\r\nfunction confirmBuying(item, index) {\r\n  Alert.alert(\r\n    \"Are you sure?\",\r\n    \"Unlock this avatar with $\" + item[\"price\"],\r\n    [\r\n      {\r\n        text: \"Cancel\",\r\n        onPress: () => console.log(\"Cancel Pressed\"),\r\n        style: \"cancel\",\r\n      },\r\n      {\r\n        text: \"OK\",\r\n        onPress: () => {\r\n          if (baseCurrency >= item[\"price\"]) {\r\n            completeBuying(item[\"price\"]);\r\n            recordBuying(index, !item[\"bought\"], item[\"img\"], item[\"price\"]);\r\n          } else {\r\n            Alert.alert(\"Sorry, you can't afford this item.\");\r\n          }\r\n        },\r\n      },\r\n    ],\r\n    { cancelable: false }\r\n  );\r\n}\r\n\r\n// Pop up window to confirm set the avatar on home page\r\nfunction setAvatar(item, index) {\r\n  Alert.alert(\r\n    \"Are you sure?\",\r\n    \"Raise this avatar on home page\",\r\n    [\r\n      {\r\n        text: \"Cancel\",\r\n        onPress: () => console.log(\"Cancel Pressed\"),\r\n        style: \"cancel\",\r\n      },\r\n      {\r\n        text: \"OK\",\r\n        onPress: () => {\r\n          console.log(\"hello olivia, you reached here\");\r\n          updataAvatar(index);\r\n          // completeBuying(index);\r\n        },\r\n      },\r\n    ],\r\n    { cancelable: false }\r\n  );\r\n}\r\n\r\n//Upload the chosen avatar data in firebase\r\nfunction updataAvatar(data) {\r\n  console.log(\"print out the avatar index: \" + data);\r\n  fb.database()\r\n    .ref(\"response/\" + userid + \"/\")\r\n    .update({\r\n      character: data,\r\n    })\r\n    .then(() => {\r\n      console.log(\"Success buying\");\r\n    })\r\n    .catch((error) => {\r\n      console.log(error);\r\n    });\r\n}\r\n\r\n// Tab of shop to choose items to buy\r\nfunction ShopTab() {\r\n  const [unbought, allUnbought] = useState([]);\r\n\r\n  useEffect(() => {\r\n    const unboughtRef = fb.database().ref(\"/response/\" + userid + \"/shop\");\r\n    const OnLoadingListener = unboughtRef.on(\"value\", (snapshot) => {\r\n      allUnbought([]);\r\n      snapshot.forEach(function (childSnapshot) {\r\n        // console.log(childSnapshot.val());\r\n        allUnbought((unbought) => [...unbought, childSnapshot.val()]);\r\n      });\r\n    });\r\n\r\n    return () => {\r\n      unboughtRef.off(\"value\", OnLoadingListener);\r\n    };\r\n  }, []);\r\n  return (\r\n    <View>\r\n      <SafeAreaView>\r\n        <ScrollView>\r\n          {unbought.map(function (item, index) {\r\n            if (!item[\"bought\"]) {\r\n              if (item[\"img\"] === 0) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character0} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"buy\"\r\n                      disabled={false}\r\n                      onPress={() => confirmBuying(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 1) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character1} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"buy\"\r\n                      disabled={false}\r\n                      onPress={() => confirmBuying(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 2) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character2} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"buy\"\r\n                      disabled={false}\r\n                      onPress={() => confirmBuying(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              } else if (item[\"img\"] === 3) {\r\n                return (\r\n                  <View key={item[\"img\"]} style={styles.itemContainer}>\r\n                    <Image style={styles.avatar} source={images.character3} />\r\n                    <Text style={styles.text}>Price: {item[\"price\"]}</Text>\r\n                    <Button\r\n                      title=\"buy\"\r\n                      disabled={false}\r\n                      onPress={() => confirmBuying(item, index)}\r\n                    />\r\n                  </View>\r\n                );\r\n              }\r\n            }\r\n          })}\r\n        </ScrollView>\r\n      </SafeAreaView>\r\n    </View>\r\n  );\r\n}\r\nShopTab.navigationOptions = {\r\n  tabBarIcon: ({ tintColor, focused }) => (\r\n    <Icon name={focused ? \"ios-cart\" : \"md-cart\"} color={tintColor} size={25} />\r\n  ),\r\n};\r\n\r\nconst Tab = createMaterialTopTabNavigator(\r\n  {\r\n    Shop: ShopTab,\r\n    Owned: OwnedTab,\r\n  },\r\n  {\r\n    tabBarOptions: {\r\n      activeTintColor: \"black\",\r\n      showIcon: true,\r\n      showLabel: true,\r\n      style: {\r\n        backgroundColor: \"transparent\",\r\n      },\r\n    },\r\n  }\r\n);\r\nconst AppIndex = createAppContainer(Tab);\r\n\r\nexport default class HomeScreen extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      avatarCurrency: 0,\r\n      items: {},\r\n    };\r\n    if (!fb.apps.length) {\r\n      fb.initializeApp(ApiKeys.FirebaseConfig);\r\n    }\r\n    this.readData();\r\n  }\r\n\r\n  readData() {\r\n    userid = Fire.shared.user._id;\r\n    fb.database()\r\n      .ref(\"response/\" + userid + \"/currency\")\r\n      .once(\"value\", (dataSnapShot) => {\r\n        baseCurrency = dataSnapShot.val();\r\n      });\r\n    fb.database()\r\n      .ref(\"response/\" + userid + \"/backgroundColor\")\r\n      .once(\"value\", (dataSnapShot) => {\r\n        var tempColor = dataSnapShot.val();\r\n        this.setState({ backgroundColor: tempColor });\r\n      });\r\n  }\r\n\r\n  componentDidMount() {\r\n    fb.database()\r\n      .ref(\"response/\" + userid + \"/shop\")\r\n      .on(\"value\", (querySnapShot) => {\r\n        let data = querySnapShot.val() ? querySnapShot.val() : {};\r\n        let shopitems = { ...data };\r\n        this.setState({\r\n          items: shopitems,\r\n        });\r\n      });\r\n    fb.database()\r\n      .ref(\"response/\" + userid + \"/currency\")\r\n      .on(\"value\", (querySnapShot) => {\r\n        let data = querySnapShot.val() ? querySnapShot.val() : {};\r\n        this.setState({\r\n          avatarCurrency: data,\r\n        });\r\n      });\r\n  }\r\n\r\n  render() {\r\n    const background = getBackgroundImage(this.state.backgroundColor);\r\n    return (\r\n      <View style={styles.container}>\r\n        <ImageBackground source={background} style={styles.backgroundImage}>\r\n          <Header\r\n            props={this.props}\r\n            pageName=\"Avatar Shop\"\r\n            baseCurrency={this.state.avatarCurrency}\r\n          />\r\n          <AppIndex />\r\n        </ImageBackground>\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nconst styles = StyleSheet.create({\r\n  container: {\r\n    backgroundColor: \"#f0f8ff\",\r\n    flex: 1,\r\n    flexDirection: \"column\",\r\n  },\r\n\r\n  backgroundImage: {\r\n    flex: 1,\r\n    resizeMode: \"cover\",\r\n    justifyContent: \"center\",\r\n  },\r\n\r\n  itemContainer: {\r\n    height: 230,\r\n    borderWidth: 0.5,\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    margin: 3,\r\n  },\r\n\r\n  avatarContainer: {\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n  },\r\n\r\n  avatar: {\r\n    width: \"30%\",\r\n    height: \"50%\",\r\n    alignItems: \"center\",\r\n  },\r\n\r\n  buyText: {\r\n    textAlign: \"center\",\r\n  },\r\n\r\n  text: {\r\n    marginTop: 5,\r\n    fontSize: 16,\r\n    fontWeight: \"500\",\r\n  },\r\n});\r\n"]},"metadata":{},"sourceType":"module"}